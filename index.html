<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Minesweeper („Éû„Ç§„É≥„Çπ„Ç§„Éº„Éë„Éº)</title>
<style>
  :root{
    --cell-size: 36px;
    --gap: 6px;
    --bg: #f0f3f7;
    --panel: #2b2f3a;
    --accent: #ff5c5c;
  }
  body{
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Yu Gothic", "Meiryo", sans-serif;
    background: linear-gradient(180deg,#e9eef6,#f8fafc);
    margin:0;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:24px;
  }
  .container{
    background: white;
    padding:20px;
    border-radius:12px;
    box-shadow: 0 8px 30px rgba(20,30,60,0.12);
    max-width: 760px;
    width:100%;
  }
  header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    margin-bottom:12px;
  }
  h1{ font-size:1.1rem; margin:0; color:var(--panel) }
  .controls{ display:flex; gap:8px; align-items:center; flex-wrap:wrap }
  select, button{
    padding:8px 10px;
    border-radius:8px;
    border:1px solid #d7dce6;
    background:white;
    font-size:0.95rem;
  }
  .status{
    display:flex;
    gap:8px;
    align-items:center;
    margin-bottom:12px;
  }
  .badge{
    padding:8px 12px;
    border-radius:10px;
    background: #101418;
    color:white;
    font-weight:700;
    min-width:90px;
    text-align:center;
    box-shadow: inset 0 -3px 0 rgba(0,0,0,0.12);
  }
  .info{
    display:flex;
    gap:8px;
    align-items:center;
    color:#475569;
  }

  /* board */
  .board-wrap{
    display:flex;
    justify-content:center;
  }
  .board{
    display:grid;
    gap: var(--gap);
    padding: var(--gap);
    background: linear-gradient(180deg,#e6eef7,#f7fbff);
    border-radius:12px;
    border:1px solid #dfe8f4;
  }

  /* cell */
  .cell{
    width: var(--cell-size);
    height: var(--cell-size);
    display:grid;
    place-items:center;
    font-weight:700;
    border-radius:6px;
    user-select:none;
    cursor:pointer;
    background: linear-gradient(180deg,#f8fbff,#e9f0f8);
    border:1px solid rgba(15,20,30,0.06);
    box-shadow: 0 2px 0 rgba(255,255,255,0.6) inset;
    font-family: "Courier New", monospace;
  }
  .cell.open{
    background: linear-gradient(180deg,#ffffff,#e8eef6);
    box-shadow:none;
    cursor:default;
  }
  .cell.mine{
    background: linear-gradient(180deg,#ffefef,#ffd6d6);
  }
  .cell.flag{
    background: linear-gradient(180deg,#fff7e6,#fff1d6);
  }
  .cell .num-1{ color:#1976d2 }
  .cell .num-2{ color:#00796b }
  .cell .num-3{ color:#d32f2f }
  .cell .num-4{ color:#3f51b5 }
  .cell .num-5{ color:#b71c1c }
  .cell .num-6{ color:#00695c }
  .cell .num-7{ color:#3e2723 }
  .cell .num-8{ color:#424242 }

  .footer{
    margin-top:12px;
    display:flex;
    justify-content:space-between;
    color:#6b7280;
    font-size:0.9rem;
  }

  /* responsive */
  @media (max-width:520px){
    :root{ --cell-size:30px; --gap:5px }
    .badge{ min-width:72px; padding:6px 8px }
  }
</style>
</head>
<body>
  <div class="container" role="application" aria-label="Minesweeper game">
    <header>
      <h1>üß© MinesweeperÔºàMinesweeperÔºâ</h1>
      <div class="controls">
        <label for="difficulty">level</label>
        <select id="difficulty" aria-label="choose difficulty">
          <option value="easy">EasyÔºà8x8, 10bombÔºâ</option>
          <option value="medium">MediumÔºà11x11, 24bombÔºâ</option>
          <option value="hard">HardÔºà13x13, 52bomb</option>
          <option value="custom">Custom</option>
        </select>
        <button id="resetBtn">reset</button>
      </div>
    </header>

    <div class="status">
      <div class="badge" id="minesLeft">M: 0</div>
      <div class="badge" id="timer">00:00</div>
      <div class="info" id="message">please start Game</div>
    </div>

    <div class="board-wrap">
      <div id="board" class="board" role="grid" aria-label="game board"></div>
    </div>

    <div class="footer">
      <div>right click is frag Ôºàmobile is long pressÔºâ</div>
      <div>made with joe yabuki</div>
    </div>
  </div>

<script>
/* Minesweeper main script
 - left click = open
 - right click = frag
 - change difficulty„ÄÅtimer„ÄÅremaining bombs
*/

// --- settings per difficulty
const presets = {
  easy: { rows: 9, cols: 9, mines: 10 },
  medium: { rows: 16, cols: 16, mines: 40 },
  hard: { rows: 16, cols: 30, mines: 99 }
};

let rows = 9, cols = 9, totalMines = 10;
let boardEl = document.getElementById('board');
let minesLeftEl = document.getElementById('minesLeft');
let timerEl = document.getElementById('timer');
let messageEl = document.getElementById('message');
let difficultyEl = document.getElementById('difficulty');
let resetBtn = document.getElementById('resetBtn');

let grid = []; // cell objects
let started = false, finished = false;
let flags = 0, openedCount = 0;
let timerId = null, seconds = 0;

// cell structure: {row, col, mine:boolean, open:boolean, flag:boolean, adj:number, el:DOM}
// initialize
function initFromDifficulty(diff) {
  if (diff in presets) {
    rows = presets[diff].rows;
    cols = presets[diff].cols;
    totalMines = presets[diff].mines;
  } else {
    // custom default same as easy
    rows = 9; cols = 9; totalMines = 10;
  }
  resetGame();
}

function resetGame(){
  // clear timer
  if (timerId) { clearInterval(timerId); timerId = null; }
  seconds = 0; timerEl.textContent = formatTime(seconds);
  started = false; finished = false;
  flags = 0; openedCount = 0;
  grid = [];
  boardEl.innerHTML = '';
  boardEl.style.gridTemplateColumns = `repeat(${cols}, var(--cell-size))`;
  boardEl.style.gridTemplateRows = `repeat(${rows}, var(--cell-size))`;
  minesLeftEl.textContent = `M: ${totalMines - flags}`;
  messageEl.textContent = 'Click to start the game';

  // create cells
  for (let r=0;r<rows;r++){
    for (let c=0;c<cols;c++){
      const cell = {
        row: r, col: c,
        mine: false, open: false, flag: false,
        adj: 0,
        el: null
      };
      const el = document.createElement('button');
      el.className = 'cell';
      el.setAttribute('data-r', r);
      el.setAttribute('data-c', c);
      el.setAttribute('aria-label', `cell ${r+1},${c+1}`);
      el.addEventListener('click', onCellLeftClick);
      el.addEventListener('contextmenu', onCellRightClick);
      // mobile long press for flag
      addLongPress(el, () => handleFlag(cell));
      el.addEventListener('mousedown', ()=> el.classList.add('active'));
      el.addEventListener('mouseup', ()=> el.classList.remove('active'));
      cell.el = el;
      boardEl.appendChild(el);
      grid.push(cell);
    }
  }
}

// helper: index by r,c
function idx(r,c){ return r*cols + c; }
function getCell(r,c){
  if (r<0||c<0||r>=rows||c>=cols) return null;
  return grid[idx(r,c)];
}

// place mines after first click (so first click never hits a mine)
function placeMines(firstR, firstC){
  let placed = 0;
  const total = totalMines;
  const banned = new Set();
  // ban first cell and its neighbors
  for (let dr=-1; dr<=1; dr++){
    for (let dc=-1; dc<=1; dc++){
      const nr = firstR+dr, nc = firstC+dc;
      if (nr>=0 && nc>=0 && nr<rows && nc<cols){
        banned.add(idx(nr,nc));
      }
    }
  }

  while (placed < total) {
    const r = Math.floor(Math.random()*rows);
    const c = Math.floor(Math.random()*cols);
    const i = idx(r,c);
    if (banned.has(i)) continue;
    const cell = getCell(r,c);
    if (!cell.mine) {
      cell.mine = true;
      placed++;
    }
  }
  // compute adjacency counts
  for (let cell of grid){
    if (cell.mine) continue;
    let count=0;
    for (let dr=-1; dr<=1; dr++){
      for (let dc=-1; dc<=1; dc++){
        if (dr===0 && dc===0) continue;
        const n = getCell(cell.row+dr, cell.col+dc);
        if (n && n.mine) count++;
      }
    }
    cell.adj = count;
  }
}

// opening cell logic (flood fill if adj==0)
function openCell(cell){
  if (cell.open || cell.flag || finished) return;
  cell.open = true;
  openedCount++;
  const el = cell.el;
  el.classList.add('open');
  if (cell.mine){
    el.classList.add('mine');
    el.textContent = 'üí£';
    // reveal all mines and end game
    revealMines(cell);
    loseGame();
    return;
  }
  if (cell.adj > 0){
    const span = document.createElement('span');
    span.textContent = cell.adj;
    span.className = `num-${cell.adj}`;
    el.appendChild(span);
  } else {
    // empty => reveal neighbors
    for (let dr=-1; dr<=1; dr++){
      for (let dc=-1; dc<=1; dc++){
        if (dr===0 && dc===0) continue;
        const n = getCell(cell.row+dr, cell.col+dc);
        if (n && !n.open && !n.flag) openCell(n);
      }
    }
  }
  checkWin();
}

function revealMines(triggerCell){
  for (let cell of grid){
    if (cell.mine){
      if (!cell.open){
        cell.el.classList.add('open','mine');
        cell.el.textContent = 'üí£';
      }
    } else {
      // show incorrect flags
      if (cell.flag && !cell.mine){
        cell.el.classList.add('open');
        cell.el.textContent = '‚úñ';
      }
    }
  }
  // highlight the clicked mine
  if (triggerCell) triggerCell.el.style.boxShadow = 'inset 0 0 0 3px rgba(255,90,90,0.12)';
}

function loseGame(){
  finished = true;
  if (timerId) { clearInterval(timerId); timerId=null; }
  messageEl.textContent = 'üí£ Landmine detection„ÄÄGame over';
}

function winGame(){
  finished = true;
  if (timerId) { clearInterval(timerId); timerId=null; }
  messageEl.textContent = `üèÜ clear!! time: ${formatTime(seconds)}`;
  // reveal flags nicely
  for (let cell of grid){
    if (cell.mine){
      cell.el.classList.add('open');
      cell.el.textContent = 'üö©';
    }
  }
}

// check if all non-mine cells are opened
function checkWin(){
  const totalCells = rows*cols;
  if (openedCount === totalCells - totalMines){
    winGame();
  }
}

// flag toggle
function handleFlag(cell){
  if (cell.open || finished) return;
  cell.flag = !cell.flag;
  if (cell.flag){
    cell.el.classList.add('flag');
    cell.el.textContent = 'üö©';
    flags++;
  } else {
    cell.el.classList.remove('flag');
    cell.el.textContent = '';
    flags--;
  }
  minesLeftEl.textContent = `M: ${totalMines - flags}`;
}

// left click handler
function onCellLeftClick(e){
  if (finished) return;
  const r = parseInt(this.dataset.r,10);
  const c = parseInt(this.dataset.c,10);
  const cell = getCell(r,c);

  // first click: plant mines avoiding this cell
  if (!started){
    placeMines(r,c);
    started = true;
    startTimer();
    messageEl.textContent = 'May the Force be with you';
  }

  // if flagged -> ignore left click
  if (cell.flag) return;

  openCell(cell);
}

// right click handler
function onCellRightClick(e){
  e.preventDefault();
  if (finished) return;
  const r = parseInt(this.dataset.r,10);
  const c = parseInt(this.dataset.c,10);
  const cell = getCell(r,c);
  handleFlag(cell);
}

// timer
function startTimer(){
  if (timerId) return;
  timerId = setInterval(()=>{
    seconds++;
    timerEl.textContent = formatTime(seconds);
  },1000);
}
function formatTime(s){
  const mm = String(Math.floor(s/60)).padStart(2,'0');
  const ss = String(s%60).padStart(2,'0');
  return `${mm}:${ss}`;
}

// add long-press detection for mobile flags
function addLongPress(el, callback){
  let timer = null;
  let moved = false;
  const start = (e)=>{
    moved = false;
    if (timer) clearTimeout(timer);
    timer = setTimeout(()=> {
      callback();
      timer = null;
    }, 500);
  };
  const cancel = ()=>{
    if (timer) { clearTimeout(timer); timer=null; }
  };
  el.addEventListener('touchstart', start, {passive:true});
  el.addEventListener('touchmove', ()=> moved=true, {passive:true});
  el.addEventListener('touchend', (e)=>{
    if (timer && !moved) { // short tap: let click handle it
      cancel();
    }
  });

  // also mouse fallback so long press doesn't block
  el.addEventListener('mousedown', (ev)=>{
    if (ev.button === 2) return; // right-click handled elsewhere
    timer = setTimeout(()=> {
      callback();
      timer = null;
    }, 600);
  });
  el.addEventListener('mouseup', cancel);
  el.addEventListener('mouseleave', cancel);
}

// difficulty & reset wiring
difficultyEl.addEventListener('change', (e)=>{
  if (e.target.value === 'custom'){
    // ask quickly for custom params via prompt (no blocking needed but okay)
    const r = parseInt(prompt('Number of rows (e.g., 10)', '10'), 10) || 9;
const c = parseInt(prompt('Number of columns (e.g., 10)', '10'), 10) || 9;
const m = parseInt(prompt('Number of mines (e.g., 15)', '15'), 10) || 10;
    rows = Math.max(5, Math.min(40, r));
    cols = Math.max(5, Math.min(60, c));
    totalMines = Math.max(1, Math.min(rows*cols-1, m));
    resetGame();
  } else {
    initFromDifficulty(e.target.value);
  }
});

resetBtn.addEventListener('click', ()=>{
  // if difficulty set to custom, keep current rows/cols/mines
  resetGame();
});

// keyboard accessibility: space or enter triggers click on focused cell
document.addEventListener('keydown', (e)=>{
  const active = document.activeElement;
  if (!active || !active.classList || !active.classList.contains('cell')) return;
  if (e.key === ' ' || e.key === 'Enter') {
    active.click();
    e.preventDefault();
  } else if (e.key.toLowerCase() === 'f') {
    // f to toggle flag
    active.dispatchEvent(new MouseEvent('contextmenu', {bubbles:true, cancelable:true}));
  }
});

// init default
initFromDifficulty('easy');

</script>
</body>
</html>

