<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Minesweeper</title>
<style>
  :root{
    --cell-size: 36px;
    --gap: 6px;
    --bg: #f0f3f7;
    --panel: #2b2f3a;
    --accent: #ff5c5c;
  }
  body{
    font-family: system-ui, sans-serif;
    background: linear-gradient(180deg,#e9eef6,#f8fafc);
    margin:0;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:24px;
  }
  .container{
    background: white;
    padding:20px;
    border-radius:12px;
    box-shadow: 0 8px 30px rgba(20,30,60,0.12);
    max-width: 860px;
    width:100%;
  }
  header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    margin-bottom:12px;
  }
  h1{ font-size:1.1rem; margin:0; color:var(--panel) }
  .controls{ display:flex; gap:8px; align-items:center; flex-wrap:wrap }
  select, button{
    padding:8px 10px;
    border-radius:8px;
    border:1px solid #d7dce6;
    background:white;
    font-size:0.95rem;
  }
  .status{
    display:flex;
    gap:8px;
    align-items:center;
    margin-bottom:12px;
  }
  .badge{
    padding:8px 12px;
    border-radius:10px;
    background: #101418;
    color:white;
    font-weight:700;
    min-width:90px;
    text-align:center;
    box-shadow: inset 0 -3px 0 rgba(0,0,0,0.12);
  }
  .info{
    display:flex;
    gap:8px;
    align-items:center;
    color:#475569;
  }
  .board-wrap{
    display:flex;
    justify-content:center;
  }
  .board{
    display:grid;
    gap: var(--gap);
    padding: var(--gap);
    background: linear-gradient(180deg,#e6eef7,#f7fbff);
    border-radius:12px;
    border:1px solid #dfe8f4;
  }
  .cell{
    width: var(--cell-size);
    height: var(--cell-size);
    display:grid;
    place-items:center;
    font-weight:700;
    border-radius:6px;
    user-select:none;
    cursor:pointer;
    background: linear-gradient(180deg,#f8fbff,#e9f0f8);
    border:1px solid rgba(15,20,30,0.06);
    font-family: "Courier New", monospace;
  }
  .cell.open{
    background: linear-gradient(180deg,#ffffff,#e8eef6);
    cursor:default;
  }
  .cell.mine{
    background: linear-gradient(180deg,#ffefef,#ffd6d6);
  }
  .cell.flag{
    background: linear-gradient(180deg,#fff7e6,#fff1d6);
  }
  .cell .num-1{ color:#1976d2 }
  .cell .num-2{ color:#00796b }
  .cell .num-3{ color:#d32f2f }
  .cell .num-4{ color:#3f51b5 }
  .cell .num-5{ color:#b71c1c }
  .cell .num-6{ color:#00695c }
  .cell .num-7{ color:#3e2723 }
  .cell .num-8{ color:#424242 }

  .footer{
    margin-top:12px;
    display:flex;
    justify-content:space-between;
    color:#6b7280;
    font-size:0.9rem;
  }

  table { width:100%; border-collapse:collapse; margin-top:20px; }
  th, td { padding:6px; text-align:center; }
  th { background:#e8edf5; }

  @media (max-width:520px){
    :root{ --cell-size:30px; --gap:5px }
    .badge{ min-width:72px; padding:6px 8px }
  }
</style>
</head>

<body>
  <div class="container" role="application" aria-label="Minesweeper game">
    <header>
      <h1>ðŸ§© Minesweeper</h1>
      <div class="controls">
        <label for="difficulty">Level</label>
        <select id="difficulty" aria-label="choose difficulty">
          <option value="easy">Easy (9x9 / 10 Mines)</option>
          <option value="medium">Medium (16x16 / 40 Mines)</option>
          <option value="hard">Hard (16x30 / 99 Mines)</option>
          <option value="custom">Custom</option>
        </select>
        <button id="resetBtn">Reset</button>
      </div>
    </header>

    <div class="status">
      <div class="badge" id="minesLeft">M: 0</div>
      <div class="badge" id="timer">00:00</div>
      <div class="info" id="message">Click to start</div>
    </div>

    <div class="board-wrap">
      <div id="board" class="board" role="grid" aria-label="game board"></div>
    </div>

    <div class="footer">
      <div>Right click = Flag (mobile: long press)</div>
      <div>By Joe Yabuki</div>
    </div>

    <h2 style="margin-top:24px; font-size:1rem; color:#2b2f3a;">Play History</h2>
    <table id="historyTable">
      <thead>
        <tr><th>Result</th><th>Time</th><th>Date</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <button id="clearHistoryBtn">Clear History</button>
  </div>

<script>
const presets = {
  easy: { rows: 9, cols: 9, mines: 10 },
  medium: { rows: 16, cols: 16, mines: 40 },
  hard: { rows: 16, cols: 30, mines: 99 }
};

let rows, cols, totalMines;
let grid = [];
let started = false, finished = false;
let flags = 0, openedCount = 0;
let timerId = null, seconds = 0;

const boardEl = document.getElementById('board');
const minesLeftEl = document.getElementById('minesLeft');
const timerEl = document.getElementById('timer');
const messageEl = document.getElementById('message');
const difficultyEl = document.getElementById('difficulty');

function idx(r,c){ return r*cols + c; }
function getCell(r,c){
  if(r<0||c<0||r>=rows||c>=cols) return null;
  return grid[idx(r,c)];
}

function initFromDifficulty(diff){
  if(presets[diff]){
    rows = presets[diff].rows;
    cols = presets[diff].cols;
    totalMines = presets[diff].mines;
  } else {
    rows = 9; cols = 9; totalMines = 10;
  }
  resetGame();
}

function resetGame(){
  clearInterval(timerId);
  seconds = 0;
  timerEl.textContent = formatTime(seconds);
  started = false;
  finished = false;
  flags = 0;
  openedCount = 0;
  grid = [];
  boardEl.innerHTML = '';
  boardEl.style.gridTemplateColumns = `repeat(${cols}, var(--cell-size))`;
  boardEl.style.gridTemplateRows = `repeat(${rows}, var(--cell-size))`;
  minesLeftEl.textContent = `M: ${totalMines}`;
  messageEl.textContent = 'Click to start';

  for(let r=0; r<rows; r++){
    for(let c=0; c<cols; c++){
      const cell = {
        row:r, col:c, mine:false, open:false, flag:false, adj:0,
        el:null
      };
      const el=document.createElement('button');
      el.className='cell';
      el.dataset.r=r;
      el.dataset.c=c;
      el.addEventListener('click',onCellLeftClick);
      el.addEventListener('contextmenu',onCellRightClick);
      addLongPress(el,()=>handleFlag(cell));

      cell.el=el;
      boardEl.append(el);
      grid.push(cell);
    }
  }
}

function placeMines(fr,fc){
  let placed=0;
  const banned=new Set();
  for(let dr=-1;dr<=1;dr++){
    for(let dc=-1;dc<=1;dc++){
      const nr=fr+dr,nc=fc+dc;
      if(nr>=0&&nc>=0&&nr<rows&&nc<cols){
        banned.add(idx(nr,nc));
      }
    }
  }
  while(placed<totalMines){
    const r=Math.floor(Math.random()*rows);
    const c=Math.floor(Math.random()*cols);
    const i=idx(r,c);
    if(banned.has(i)) continue;
    const cell=getCell(r,c);
    if(!cell.mine){
      cell.mine=true;
      placed++;
    }
  }
  for(let cell of grid){
    if(cell.mine) continue;
    let n=0;
    for(let dr=-1;dr<=1;dr++){
      for(let dc=-1;dc<=1;dc++){
        if(dr===0&&dc===0) continue;
        const t=getCell(cell.row+dr, cell.col+dc);
        if(t&&t.mine) n++;
      }
    }
    cell.adj=n;
  }
}

function openCell(cell){
  if(cell.open||cell.flag||finished) return;
  cell.open=true;
  openedCount++;
  const el=cell.el;
  el.classList.add('open');

  if(cell.mine){
    el.textContent='ðŸ’£';
    revealMines(cell);
    loseGame();
    return;
  }
  if(cell.adj>0){
    const s=document.createElement('span');
    s.textContent=cell.adj;
    s.className = `num-${cell.adj}`;
    el.appendChild(s);
  } else {
    for(let dr=-1;dr<=1;dr++){
      for(let dc=-1;dc<=1;dc++){
        if(dr===0&&dc===0) continue;
        const n=getCell(cell.row+dr, cell.col+dc);
        if(n&&!n.open&&!n.flag) openCell(n);
      }
    }
  }
  checkWin();
}

function revealMines(){
  for(let cell of grid){
    if(cell.mine){
      cell.el.classList.add('open');
      cell.el.textContent='ðŸ’£';
    }
  }
}

function loseGame(){
  finished=true;
  clearInterval(timerId);
  messageEl.textContent='ðŸ’¥ Game Over';
  saveRecord("LOSE");
  updateHistoryUI();
}

function winGame(){
  finished=true;
  clearInterval(timerId);
  messageEl.textContent='ðŸ† You Win! Time '+formatTime(seconds);
  for(let cell of grid){
    if(cell.mine){
      cell.el.classList.add('open');
      cell.el.textContent='ðŸš©';
    }
  }
  saveRecord("WIN");
  updateHistoryUI();
}

function checkWin(){
  if(openedCount === rows*cols - totalMines){
    winGame();
  }
}

function handleFlag(cell){
  if(cell.open||finished) return;
  cell.flag=!cell.flag;
  if(cell.flag){
    cell.el.classList.add('flag');
    cell.el.textContent='ðŸš©';
    flags++;
  } else {
    cell.el.classList.remove('flag');
    cell.el.textContent='';
    flags--;
  }
  minesLeftEl.textContent=`M: ${totalMines-flags}`;
}

function onCellLeftClick(){
  if(finished)return;
  const r=parseInt(this.dataset.r), c=parseInt(this.dataset.c);
  const cell=getCell(r,c);

  if(!started){
    placeMines(r,c);
    started=true;
    startTimer();
    messageEl.textContent='Good luck!';
  }
  if(cell.flag)return;
  openCell(cell);
}

function onCellRightClick(e){
  e.preventDefault();
  const r=parseInt(this.dataset.r), c=parseInt(this.dataset.c);
  handleFlag(getCell(r,c));
}

function startTimer(){
  timerId=setInterval(()=>{
    seconds++;
    timerEl.textContent=formatTime(seconds);
  },1000);
}

function formatTime(s){
  return String(Math.floor(s/60)).padStart(2,'0')+":"+String(s%60).padStart(2,'0');
}

function addLongPress(el,cb){
  let t;
  el.addEventListener('touchstart',()=>t=setTimeout(cb,500));
  el.addEventListener('touchend',()=>clearTimeout(t));
}

function saveRecord(result){
  const list=JSON.parse(localStorage.getItem("minesweeperRecords")||"[]");
  list.push({
    result,
    time:formatTime(seconds),
    date:new Date().toLocaleString()
  });
  localStorage.setItem("minesweeperRecords",JSON.stringify(list));
}

function updateHistoryUI(){
  const tbody=document.querySelector("#historyTable tbody");
  const list=JSON.parse(localStorage.getItem("minesweeperRecords")||"[]");
  tbody.innerHTML="";
  list.slice().reverse().forEach(r=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${r.result}</td><td>${r.time}</td><td>${r.date}</td>`;
    tbody.append(tr);
  });
}

document.getElementById("clearHistoryBtn").addEventListener("click", ()=>{
  localStorage.removeItem("minesweeperRecords");
  updateHistoryUI();
});

difficultyEl.addEventListener("change", e=>{
  if(e.target.value==="custom"){
    rows=parseInt(prompt("Rows?",10))||9;
    cols=parseInt(prompt("Cols?",10))||9;
    totalMines=parseInt(prompt("Mines?",15))||10;
    resetGame();
  } else {
    initFromDifficulty(e.target.value);
  }
});

document.getElementById("resetBtn").addEventListener("click", resetGame);

initFromDifficulty("easy");
updateHistoryUI();
</script>
</body>
</html>
